# Defect Detection System for Package Inspection

Система автоматического обнаружения дефектов упаковки на основе двухстадийной сегментации YOLOv8.

## О проекте

Разработка системы для автоматизации контроля целостности упаковки грузов на складах. Система обнаруживает и классифицирует дефекты упаковки с помощью компьютерного зрения, что позволяет сократить финансовые потери от поврежденных товаров.

## Архитектура системы

**Двухстадийный подход (инстанс сегментация):**
1. **Первая стадия**: сегментация коробок на изображении
2. **Вторая стадия**: обнаружение и классификация дефектов на вырезанных коробках

**Преимущества подхода:**
- Исключение влияния фона на распознавание дефектов
- Высокая точность локализации
- Возможность работы в реальном времени

## Датасеты

### 1. Распознавание коробок
- **Источники**: TAMPAR, Parcel2D, AISS-CV, Google Images, Яндекс.Картинки, кадры видеозаписей с передвигающимися по конвейерным лентам коробками, самостоятельно подготовленные данные
- **Объем**: 6,000 изображений (662 негативных примера): 10,128 коробок
- **Разметка**: полуавтоматическая кликовая сегментация

### 2. Распознавание и классификация дефектов
- **Типы дефектов**: 
  - `hole` - отверстие
  - `open` - открытая коробка  
  - `dent` - вмятина
- **Объем**: 3,080 изображений (112 без дефектов): 4,943 дефектов
- **Баланс классов**: требует доработки (3,082 дефекта «отверстие», 1,361 – «открытая коробка», 500 – «вмятина»)
- **Разметка**: полуавтоматическая кликовая сегментация

## Структура данных

### YOLOv8 формат:

```
dataset/
├── images/
│   ├── train/
│   └── val/
└── labels/
    ├── train/
    └── val/
```

### Формат аннотаций:

```
<class_id> <x1> <y1> <x2> <y2> ... <xn> <yn>
```

## Результаты

### Распознавание коробок (YOLOv8m)

- mAP@50: 99.49%
- mAP@50-95: 98.43%
- Segmentation Loss: 0.1846

### Классификация дефектов (YOLOv8s)

- mAP@50: 99.34%
- mAP@50-95: 86.04%
- Segmentation Loss: 0.8766
- Classification Loss: 0.3204

## Ключевые особенности и основные возможности

- **Полуавтоматическая разметка**: кликовая интерактивная сегментация
- **Двухстадийная архитектура**: повышение точности за счет исключения фона
- **Поддержка YOLOv8**: современные модели сегментации
- **Преобразование данных**: конвертация между форматами COCO, YOLOv8 и масками
- **Обработка видео**: извлечение кадров для создания датасетов
- **Визуализация**: инструменты для анализа разметки и результатов
- **Анализ моделей**: мониторинг процесса обучения и сравнение моделей
- **Сегментация**: поддержка instance segmentation с полигонами

## Планы развития

- Увеличение датасета дефектов
- Балансировка классов
- Добавление новых типов дефектов (намокшие коробки)
- Интеграция трекинга для идентификации коробок
- Оптимизация для edge-устройств

## Структура проекта

```
scripts/
├── data_preparation/
│   ├── cut_videos.py
│   ├── coco_to_yolov8.py
│   └── mask_to_poly.py
├── visualization/
│   ├── markup.py
│   ├── segmentation.py
│   ├── show_segm_masks.py
│   └── plot_data_desc.py
└── evaluation/
    ├── plot_training_results.py
    └── models_args.py
```

### Data Preparation
- `cut_videos.py` - извлечение кадров из видео для создания датасета
- `coco_to_yolov8.py` - конвертация аннотаций из COCO в YOLOv8 формат
- `mask_to_poly.py` - преобразование бинарных масок в полигоны для YOLO

### Visualization
- `markup.py` - визуализация bounding boxes на изображениях
- `segmentation.py` - визуализация полигонов сегментации
- `show_segm_masks.py` - отображение сегментационных масок YOLO формата
- `plot_data_desc.py` - построение графиков статистики датасета

### Evaluation
- `plot_training_results.py` - визуализация метрик обучения (loss, mAP)
- `models_args.py` - анализ гиперпараметров моделей

## Быстрый старт

### Установка зависимостей
```bash
pip install ultralytics opencv-python shapely numpy pandas matplotlib plotly natsort tqdm
